

<?php
require_once("config.php");

$LEC_ID = array();
$LECQUERY = $mysqli->query("SELECT DISTINCT lec_id FROM timetable");
while ($row = $LECQUERY->fetch_assoc()) {
    $LEC_ID[] = $row["lec_id"];
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
<link rel="stylesheet" href="/asset/timetable.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timetable</title>
    <style>
        /* CSS styles here */
    </style>
</head>
<body>

<?php
$timeSlots = array(
    "08:00 AM - 09:00 AM",
    "09:00 AM - 10:00 AM",
    "10:00 AM - 11:00 AM",
    "11:00 AM - 12:00 PM",
    "12:00 PM - 01:00 PM",
    "01:00 PM - 02:00 PM",
    "02:00 PM - 03:00 PM",
    "03:00 PM - 04:00 PM",
    "04:00 PM - 05:00 PM"
);
?>

<?php
foreach ($LEC_ID as $lecturerId) {
    $result = $mysqli->query("
        SELECT t.*, l.lecname AS lecname
        FROM timetable t
        JOIN lecturer l ON t.lec_id = l.lec_id
        WHERE t.lec_id = '$lecturerId'
        ORDER BY FIELD(t.day, 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday')
    ");

    if ($result->num_rows > 0) {
        echo "<div class='timetable-section'>";
        $firstRow = $result->fetch_assoc();
        $lecname = $firstRow['lecname'];
        echo "<h2>Lecturer name: $lecname</h2>";
        echo "<table class ="custom-table" border='1'>";
        echo "<tr><th></th>";

        foreach ($timeSlots as $timeSlot) {
            echo "<th>$timeSlot</th>";
        }

        echo "</tr>";

        foreach (array('Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday') as $day) {
            echo "<tr>";
            echo "<td>$day</td>";

            foreach ($timeSlots as $index => $timeSlot) {
                $classData = '';
                $rowspan = 1;
                list($startTime, $endTime) = explode(' - ', $timeSlot);
                $classFound = false;

                while ($class = $result->fetch_assoc()) {
                    $classStartTime = strtotime($class['start_time']);
                    $classEndTime = strtotime($class['end_time']);

                    if ($classStartTime == strtotime($startTime) && $classEndTime == strtotime($endTime) && strtolower($class['day']) == strtolower($day)) {
                        $classData = "{$class['subject_name']}<br>{$class['lecname']}<br>{$class['classtype']}"; // Use 'lecname' field here

                        // Calculate rowspan for continuous class hours
                        for ($i = $index + 1; $i < count($timeSlots); $i++) {
                            list($nextStartTime, $nextEndTime) = explode(' - ', $timeSlots[$i]);
                            $nextClassStartTime = strtotime($nextStartTime);
                            $nextClassEndTime = strtotime($nextEndTime);

                            if ($nextClassStartTime == $classEndTime && strtolower($class['day']) == strtolower($day)) {
                                $rowspan++;
                                $classEndTime = $nextClassEndTime;
                            } else {
                                break;
                            }
                        }

                        $classFound = true;
                        break;
                    }
                }

                if (!$classFound && strtolower($day) != 'saturday' && strtolower($day) != 'sunday') {
                    $randomStartTime = strtotime("08:00 AM"); // Minimum start time
                    $randomEndTime = strtotime("03:00 PM"); // Maximum start time
                    $randStartTime = rand($randomStartTime, $randomEndTime);
                    $randEndTime = strtotime('+2 hours', $randStartTime);

                    if (strtotime($startTime) <= $randStartTime && strtotime($endTime) >= $randEndTime) {
                        $classData = "Random Class<br>Random Lecturer<br>Random Class Type";
                    }
                }

                if ($classData) {
                    echo "<td rowspan=\"$rowspan\">$classData</td>";
                } else {
                    echo "<td></td>";
                }
            }

            echo "</tr>";
        }

        echo "</table>";
        echo "</div>";
    }
}
?>

<footer>
    <form method='POST' action='randomizetimetable.php'>
        <button type='submit' name='randomize'>Randomize Timetable</button>
    </form>

    <form method='POST' action='prioritizetimeslots.php'>
        <input type='hidden' name='lecturerId' value='<?php echo $lecturerId; ?>'>
        <button type='submit' name='prioritize'>Prioritize Preferred Time Slots</button>
    </form>
    
    <!-- Other forms here -->
</footer>
</body>
</html>












<?php
require_once("config.php");

$LEC_ID = array();
$LECQUERY = $mysqli->query("SELECT DISTINCT lec_id FROM timetable");
while ($row = $LECQUERY->fetch_assoc()) {
    $LEC_ID[] = $row["lec_id"];
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
<link rel="stylesheet" href="/asset/timetable.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timetable</title>
    <style>
         td {
            height: 30;
            border: 1px solid #000;
            padding: 10px; /* Add padding for better visualization */
            width: 60; /* Adjust table cell layout */
        }
        .occupied {
            background-color: #03ad12;
        }
        .timetable-section {
            border: 1px solid #000;
            padding: 10px;
            margin-bottom: 20px;
        }
        .draggable {
    position: absolute;
    /* Other styles */
    }
    </style>
</head>
<body>

    <?php
    // Step 2: Generate timetables for each lecturer
foreach ($LEC_ID as $lecturerId) {
    // Query to fetch data from the timetable table for the current lecturer
    $result = $mysqli->query("
        SELECT t.*, l.lecname AS lecname
        FROM timetable t
        JOIN lecturer l ON t.lec_id = l.lec_id
        WHERE t.lec_id = '$lecturerId'
        ORDER BY FIELD(t.day, 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday')
    ");

    // Check if the query was successful
    if ($result->num_rows > 0) {
        echo "<div class='timetable-section'>";
        // Fetch the lecturer's name from the first row
        $firstRow = $result->fetch_assoc();
        $lecname = $firstRow['lecname'];
        echo "<h2>Lecturer name: $lecname</h2>";
        
      
    }

            echo "<table class ="custom-table" border='5' cellspacing='0'>";
            $daysOfWeek = array(
                "Monday" => array(),
                "Tuesday" => array(),
                "Wednesday" => array(),
                "Thursday" => array(),
                "Friday" => array()
            );

            // Loop through the fetched data and populate the timetable array
            while ($row = $result->fetch_assoc()) {
                $day = $row["day"];
                $subjectName = $row["subject_name"];
                $lecname = $row["lecname"];
                
                
                // Assign random start and end hours
                $startHour = rand(8, 15); // Random value between 8 and 15 (inclusive)
                $endHour = $startHour + 2; // Default to 2-hour class
                
                $daysOfWeek[$day][] = array(
                    "start_time" => $startHour,
                    "end_time" => $endHour,
                    "subject_name" => $subjectName,
                    "lecname" => $lecname
                );
            
            }
            for ($hour = 8; $hour <= 17; $hour++) {
                $formattedHour = ($hour % 12 == 0) ? 12 : $hour % 12;
                $amPm = ($hour < 12) ? "AM" : "PM";
                echo "<th>{$formattedHour} {$amPm}</th>";
            }
            // Generate timetable cells
            foreach ($daysOfWeek as $dayName => $daySlots) {
                echo "<tr>";
                echo "<td>$dayName</td>";
            
                for ($hour = 8; $hour <= 17; $hour++) {
                    $occupiedClass = '';
                    $colspan = 1;
                    $lectureSubject = '';
                    $lectureLecturer = '';
                    $labSubject = '';
                    $labLecturer = ''; 
            
                    foreach ($daySlots as $slot) {
                        if ($hour >= $slot["start_time"] && $hour < $slot["end_time"]) {
                            if ($slot["type"] === "lecture") {
                                $occupiedClass = 'occupied';
                                $lectureSubject = $slot["subject_name"];
                                $colspan = ($slot["end_time"] - $slot["start_time"]);
                                $lectureLecturer = $slot["lecname"];
                            } elseif ($slot["type"] === "lab") {
                                $labSubject = $slot["subject_name"];
                                $labLecturer = $slot["lecname"];
                            }
                            break;
                        }
                    }
            
                    if ($colspan > 1) {
                        echo "<td colspan='$colspan' class='$occupiedClass'>$lectureSubject<br>$lectureLecturer</td>";
                        $hour += $colspan - 1;
                    } else {
                        echo "<td class='$occupiedClass'>$lectureSubject<br>$lectureLecturer</td>";
                    }
                }
            
                echo "</tr>";
            }
            
            // Generate timetable cells for labs
            foreach ($daysOfWeek as $dayName => $daySlots) {
                echo "<tr>";
                echo "<td>$dayName (Lab)</td>";
            
                for ($hour = 8; $hour <= 17; $hour++) {
                    $occupiedClass = '';
                    $colspan = 1;
                    $labSubject = '';
                    $labLecturer = '';
            
                    foreach ($daySlots as $slot) {
                        if ($hour >= $slot["start_time"] && $hour < $slot["end_time"] && $slot["type"] === "lab") {
                            $occupiedClass = 'occupied';
                            $labSubject = $slot["subject_name"];
                            $colspan = ($slot["end_time"] - $slot["start_time"]);
                            $labLecturer = $slot["lecname"];
                            break;
                        }
                    }
            
                    if ($colspan > 1) {
                        echo "<td colspan='$colspan' class='$occupiedClass'>$labSubject<br>$labLecturer</td>";
                        $hour += $colspan - 1;
                    } else {
                        echo "<td class='$occupiedClass'>$labSubject<br>$labLecturer</td>";
                    }
                }
            
                echo "</tr>";
            }

            echo "</table>";
            echo "</div>";
        }
    ?>

    <footer>
        <form method="post" action="inserttimeslot.php">
            <button type="submit">Add Timeslot</button>
        </form>
        <form method="post" action="insertlecturer.html">
            <button type="submit">Add Lecturer</button>
        </form>
    </footer>
</body>
</html>



















<?php
require_once("config.php");

$LEC_ID = array();
$LECQUERY = $mysqli->query("SELECT DISTINCT lec_id FROM timetable");
while ($row = $LECQUERY->fetch_assoc()) {
    $LEC_ID[] = $row["lec_id"];
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
<link rel="stylesheet" href="/asset/timetable.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timetable</title>
    <style>
         td {
            height: 30;
            border: 1px solid #000;
            padding: 10px; /* Add padding for better visualization */
            width: 60; /* Adjust table cell layout */
        }
        .occupied {
            background-color: #03ad12;
        }
        .timetable-section {
            border: 1px solid #000;
            padding: 10px;
            margin-bottom: 20px;
        }
        .draggable {
    position: absolute;
    /* Other styles */
    }
    </style>


     <!-- Include jQuery and jQuery UI libraries -->
     <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>


</head>
<body>

<script>
    // JavaScript drag and drop functions
    function allowDrop(ev) {
        ev.preventDefault();
    }

    function drag(ev) {
        ev.dataTransfer.setData("text", ev.target.id);
    }

    function drop(ev) {
        ev.preventDefault();
        var data = ev.dataTransfer.getData("text");
        ev.target.appendChild(document.getElementById(data));
        
         // Perform additional actions here, like updating the timetable
        // You can access information about the dragged element using 'data'
    }
</script>
    <?php
    // Step 2: Generate timetables for each lecturer
    // Step 2: Generate timetables for each lecturer
    foreach ($LEC_ID as $lecturerId) {
        // Query to fetch data from the timetable table for the current lecturer
        $result = $mysqli->query("
            SELECT t.*, l.lecname AS lecname
            FROM timetable t
            JOIN lecturer l ON t.lec_id = l.lec_id
            WHERE t.lec_id = '$lecturerId'
            ORDER BY FIELD(t.day, 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday')
        ");
    
        // Check if the query was successful
        if ($result->num_rows > 0) {
            echo "<div class='timetable-section'>";
            // Fetch the lecturer's name from the first row
            $firstRow = $result->fetch_assoc();
            $lecname = $firstRow['lecname'];
            echo "<h2>Lecturer name: $lecname</h2>";
    
            // Initialize daysOfWeek array for the current lecturer
            $daysOfWeek = array(
                "Monday" => array(),
                "Tuesday" => array(),
                "Wednesday" => array(),
                "Thursday" => array(),
                "Friday" => array()
            );
    
            // Loop through the fetched data and populate the timetable array
            while ($row = $result->fetch_assoc()) {
                $day = $row["day"];
                $subjectName = $row["subject_name"];
                $lecname = $row["lecname"];
                $type = $row["classtype"];
    
                // Assign random start and end hours
                $startHour = rand(8, 15); // Random value between 8 and 15 (inclusive)
                $endHour = $startHour + 2; // Default to 2-hour class
    
                $daysOfWeek[$day][] = array(
                    "start_time" => $startHour,
                    "end_time" => $endHour,
                    "subject_name" => $subjectName,
                    "lecname" => $lecname,
                    "type" => $type
                );
            }
    
            echo "<table class ="custom-table" border='5' cellspacing='0'>";
            $daysOfWeek = array(
                "Monday" => array(),
                "Tuesday" => array(),
                "Wednesday" => array(),
                "Thursday" => array(),
                "Friday" => array()
            );

            // Loop through the fetched data and populate the timetable array
            while ($row = $result->fetch_assoc()) {
                $day = $row["day"];
                $subjectName = $row["subject_name"];
                $lecname = $row["lecname"];
                
                
                // Assign random start and end hours
                $startHour = rand(8, 15); // Random value between 8 and 15 (inclusive)
                $endHour = $startHour + 2; // Default to 2-hour class
                
                $daysOfWeek[$day][] = array(
                    "start_time" => $startHour,
                    "end_time" => $endHour,
                    "subject_name" => $subjectName,
                    "lecname" => $lecname
                );
            
            }
            for ($hour = 8; $hour <= 17; $hour++) {
                $formattedHour = ($hour % 12 == 0) ? 12 : $hour % 12;
                $amPm = ($hour < 12) ? "AM" : "PM";
                echo "<th>{$formattedHour} {$amPm}</th>";
            }
            // Generate timetable cells
            foreach ($daysOfWeek as $dayName => $daySlots) {
                echo "<tr>";
                echo "<td>$dayName</td>";
            
                for ($hour = 8; $hour <= 17; $hour++) {
                    $occupiedClass = '';
                    $colspan = 1;
                    $lectureSubject = '';
                    $lectureLecturer = '';
                    $labSubject = '';
                    $labLecturer = ''; 
            
                    foreach ($daySlots as $slot) {
                        if ($hour >= $slot["start_time"] && $hour < $slot["end_time"]) {
                            if ($slot["type"] === "lecture") {
                                $occupiedClass = 'occupied';
                                $lectureSubject = $slot["subject_name"];
                                $colspan = ($slot["end_time"] - $slot["start_time"]);
                                $lectureLecturer = $slot["lecname"];
                            } elseif ($slot["type"] === "lab") {
                                $labSubject = $slot["subject_name"];
                                $labLecturer = $slot["lecname"];
                            }
                            break;
                        }
                    }
            
                    if ($colspan > 1) {
                        echo "<td colspan='$colspan' class='$occupiedClass'>$lectureSubject<br>$lectureLecturer</td>";
                        $hour += $colspan - 1;
                    } else {
                        echo "<td class='$occupiedClass'>$lectureSubject<br>$lectureLecturer</td>";
                    }
                }
            
                echo "</tr>";
            }
            
            // Generate timetable cells for labs
            foreach ($daysOfWeek as $dayName => $daySlots) {
                echo "<tr>";
                echo "<td>$dayName (Lab)</td>";
            
                for ($hour = 8; $hour <= 17; $hour++) {
                    $occupiedClass = '';
                    $colspan = 1;
                    $labSubject = '';
                    $labLecturer = '';
            
                    foreach ($daySlots as $slot) {
                        if ($hour >= $slot["start_time"] && $hour < $slot["end_time"] && $slot["type"] === "lab") {
                            $occupiedClass = 'occupied';
                            $labSubject = $slot["subject_name"];
                            $colspan = ($slot["end_time"] - $slot["start_time"]);
                            $labLecturer = $slot["lecname"];
                            break;
                        }
                    }
            
                    if ($colspan > 1) {
                        echo "<td colspan='$colspan' class='$occupiedClass'>$labSubject<br>$labLecturer</td>";
                        $hour += $colspan - 1;
                    } else {
                        echo "<td class='$occupiedClass'>$labSubject<br>$labLecturer</td>";
                    }
                }
            
                echo "</tr>";
            }

            echo "</table>";
            echo "</div>";
        }
    }
    ?>

    <footer>
        <form method="post" action="inserttimeslot.php">
            <button type="submit">Add Timeslot</button>
        </form>
        <form method="post" action="insertlecturer.html">
            <button type="submit">Add Lecturer</button>
        </form>
    </footer>
</body>
</html>